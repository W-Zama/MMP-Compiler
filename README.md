# Mini-Mini-Pascal Compiler
作成者： **Wataru Zama**

## コンパイル方法1（`Compiler`クラスを直接使用して，C++のファイル上で実行する）
### インスタンス生成
`Compiler`クラスのインスタンスを生成する．
```cpp
// インスタンス生成
Compiler compiler;
```

### コンパイル対象のプログラムをセットする．
文字列を直接セットする場合は`Compiler::set_program_string`関数を使用する．
```cpp
// プログラムの文字列をセットする
compiler.set_program_string("A:=0.");
```
コンパイルするファイル名を指定する場合は`Compiler::set_program_file`関数を使用する．
```cpp
// ファイル名をセットする
compiler.set_program_file("sample.pas");
```

### コンパイルの実行
`Compiler::compile`関数を使ってコンパイルする．
```cpp
// コンパイル
compiler.compile();
```

### 結果の表示
結果をターミナルに表示する．
```cpp
// 結果の表示
compiler.print_result();
```
指定したファイルに結果を出力する．
```cpp
// ファイルに結果を出力
compiler.output_file("sample.obj");
```

## コンパイル方法2（コンパイラの実行ファイル`mmpc`を使用する）
### 実行コマンド
以下は`mmpc`が存在するまたはパスが通っているディレクトリで実行した例である．オプションは必須で，ファイルパスは複数指定できる．ファイルは拡張子を含める必要がある．
```terminal
mmpc [オプション（必須）] [ファイルのパス1 ファイルのパス2, ...]
```
以下はオプションの一覧である．
| オプション | 内容 |
|:----:|:----------:|
| -c | コンパイル結果をターミナルに出力する |
| -f | コンパイル結果をファイルに出力する |
| -cfまたは-fc | コンパイル結果をターミナルとファイルに出力する |
| -hまたは--help | ヘルプを表示する |

また，エラー処理も実装済．

## 仮想マシンによるオブジェクトファイルの実行
プログラムをコンパイルして得られたオブジェクトファイルを仮想マシンを使用して実行する．

### オブジェクトファイルを取得する
`Compiler`クラスから，オブジェクトファイルを取得する．
```cpp
// オブジェクトファイルを取得
vector<Command> obj = compiler.get_obj();
```

### VMクラスのインスタンスを生成する
VMクラスのインスタンスをオブジェクトファイルで生成する．
```cpp
// 仮想マシンのインスタンス生成
VM vm(compiler.get_obj());
```

### 実行
`VM::run`関数を用いて，オブジェクトファイルを実行する．入力および出力はターミナルで行われる．
```cpp
// オブジェクトファイルを実行
vm.run();
```

## ディレクトリ構成
- **sample/**: サンプルプログラムのディレクトリ
    - **sample1.pas**: サンプルプログラム1
    - **sample2.pas**: サンプルプログラム2
    - **︙**
    - **sample1.obj**: サンプルプログラム1の出力オブジェクトファイル
    - **sample2.obj**: サンプルプログラム2の出力オブジェクトファイル
    - **︙**
- **command.cpp**: `Commandクラス`のソースファイル
- **command.hpp**: `Commandクラス`のヘッダファイル
- **compiler.cpp**: `Compilerクラス`のソースファイル
- **compiler.hpp**: `Compilerクラス`のヘッダファイル
- **example.cpp**: `Compilerクラスのメソッドを使ったコンパイルの例`
- **example.sh**: `example.cppのコンパイルと実行用のシェルスクリプト`
- **mmpc**: `mmpc(mini-mini pascal compiler)の実行ファイル`
- **mmpc.cpp**: `mmpc実行ファイルのソースファイル`
- **mmpc.sh**: `mmpc.cppのコンパイル用のシェルスクリプト`
- **vm.cpp**: `VMクラスのソースファイル`
- **vm.hpp**: `VMクラスのヘッダファイル`

## 誤り処理一覧
### `Compiler`クラス
| 誤り内容 | メッセージ |
|:----:|:----------:|
| 文（statement）の末尾が`;`または`.`でない． | `文の末尾が正しく認識されません．` |
| 文（statement）がREAD文，WRITE文，代入文，`;`または`.`のみの文 | `文が正しく認識されません．` |
| `READ`の左括弧がない | `READ文の左括弧が認識されません．` |
| `READ`の変数が存在しないか，A-Zでない | `READ文の引数が正しくありません．` |
| `READ`の右括弧がない | `READ文の右括弧が認識されません．` |
| `WRITE`の左括弧がない | `WRITE文の左括弧が認識されません．` |
| `WRITE`の変数が存在しないか，A-Zでない | `WRITE文の引数が正しくありません．` |
| `WRITE`の右括弧がない | `WRITE文の右括弧が認識されません．` |
| `WHILE`の後に空白がない | `WHILE文の後に空白がありません．` |
| `WHILE`の後に`DO`がない | `WHILE文のDOが認識されません．` |
| `DO`の後に空白または改行がない | `WHILE文のDOの後に空白または改行がありません．` |
| `ENDWHILE`がない | `WHILE文の終わり(ENDWHILE)が認識されません．` |
| 関係式がの演算子が`=`か`>`か`<`の何でもない | `関係式が正しくありません．` |
| 符号なし定数が0から始まっている | `定数が0から始まっています．` |
| 符号なし定数が2147483647より大きい<br>(符号なし定数はプログラム内ではint型で格納されているためこの範囲)  | `定数が大きすぎます．` |
| カーソルがプログラムの文字列の末尾（ヌルポインタ）を指している状態でエラー | `プログラムの終わりが正しくありません．` |

誤りが検出された場合，以下の画像のようにエラーメッセージとエラー該当箇所が赤背景になった文字列が表示されます．

<br>
<img src="https://github.com/W-Zama/figure/blob/main/README_images/mmpascal_compiler/error_display.png" alt="誤り表示" width=50%>

### `mmpc`実行ファイル
| 誤り内容 | メッセージ |
|:----:|:----------:|
| 共通（全エラーで出力） | `詳しくは-hまたは--helpを参照してください． |
| 引数が1つしかない | `mmpc [オプション（必須）] [ファイルのパス1 ファイルのパス2, ...] の形式で実行してください．`　| 
| オプションが正しくない | `オプションを正しく指定してください．`　| 
|　指定されたファイルに`.`がない |　`拡張子付きファイルを指定してください．` | 

### `VM`クラス（仮想マシン）
上から順に精査．
| 誤り内容 | メッセージ |
|:----:|:----------:|
| 入力が数値でない | `正常な数値を入力してください．`　| 
| 入力が2147483647より大きい<br>(入力値はプログラム内ではint型で格納されているためこの範囲)　| `入力された数値が大きすぎます．` | 
| 入力が負の数　|　`非負の整数を入力してください．　`| 
| 入力が小数　|　`整数を入力してください．　`| 
